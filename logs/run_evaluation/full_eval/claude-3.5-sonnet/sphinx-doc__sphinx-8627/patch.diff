
--- a/sphinx/util/typing.py
+++ b/sphinx/util/typing.py
@@ -96,10 +96,12 @@ def restify(cls: Optional["Type"]) -> str:
         return '...'
     elif inspect.isNewType(cls):
         return ':class:`%s`' % cls.__name__
-    elif cls.__module__ in ('__builtin__', 'builtins'):
-        return ':class:`%s`' % cls.__name__
     else:
-        if sys.version_info >= (3, 7):  # py37+
+        # Check if it's a builtin type (not a module-level class)
+        if cls.__module__ in ('__builtin__', 'builtins'):
+            return ':class:`%s`' % cls.__name__
+        elif sys.version_info >= (3, 7):  # py37+
             return _restify_py37(cls)
         else:
             return _restify_py36(cls)
@@ -302,11 +304,13 @@ def stringify(annotation: Any) -> str:
         return 'None'
     elif (getattr(annotation, '__module__', None) == 'builtins' and
           hasattr(annotation, '__qualname__')):
-        return annotation.__qualname__
+        return annotation.__qualname__
     elif annotation is Ellipsis:
         return '...'
-
-    if sys.version_info >= (3, 7):  # py37+
+    elif hasattr(annotation, '__module__') and hasattr(annotation, '__qualname__'):
+        if sys.version_info >= (3, 7):  # py37+
+            return _stringify_py37(annotation)
+        else:
+            return _stringify_py36(annotation)
+    elif sys.version_info >= (3, 7):  # py37+
         return _stringify_py37(annotation)
     else:
         return _stringify_py36(annotation)
